<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä Tier-–ª–∏—Å—Ç–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background: #1A1A17;
            color: #000;
            padding: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #fff;
        }

        .editor-panel {
            background: #1A1A17;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .main-editor {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .tier-editor-section {
            flex: 1;
        }

        .controls {
            width: 300px;
            background: #333;
            padding: 15px;
            border-radius: 6px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #fff;
        }

        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #555;
            background: #1A1A17;
            color: #fff;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        button {
            background: #ff7f7f;
            color: #000;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button:hover {
            opacity: 0.8;
        }

        .btn-save {
            background: #bfff7f;
        }

        .btn-delete {
            background: #ff7f7f;
        }

        /* –°—Ç–∏–ª–∏ –∫–∞–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Å–∞–π—Ç–µ */
        #tier-wrap {
            margin: 20px auto;
            width: 100%;
            max-width: 1400px;
        }

        #tier-container {
            display: flex;
            flex-direction: column;
            border: solid 1px #000;
            background: #1A1A17;
        }

        .tier-row {
            display: flex;
            min-height: 120px;
            border-bottom: solid 1px #000;
        }

        .tier-row:last-child {
            border-bottom: none;
        }

        .label-holder {
            width: 100px;
            min-height: 120px;
            border-right: solid 1px #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .label {
            color: #000;
            text-align: center;
            font-weight: normal;
            font-size: 14px;
            line-height: 1.2;
        }

        .tier-content {
            flex: 1;
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
            align-content: flex-start;
            padding: 0;
            background: #2A2A27;
            min-height: 120px;
        }

        .character {
            width: 80px;
            height: 120px;
            background-position: center;
            background-size: cover;
            flex: none;
            cursor: grab;
            position: relative;
            border: none;
            margin: 0;
        }

        .character.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .tier-content.drag-over {
            background: rgba(255, 255, 255, 0.1);
        }

        .character:hover {
            border: 2px solid #fff;
            transform: scale(1.05);
            z-index: 10;
        }

        .upload-section {
            margin-bottom: 20px;
            text-align: center;
        }

        .upload-btn {
            background: #7f7fff;
            display: inline-block;
        }

        .export-buttons {
            text-align: center;
            margin-top: 30px;
        }

        .color-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .color-preview {
            width: 30px;
            height: 30px;
            border: 2px solid #fff;
            border-radius: 4px;
        }

        .edit-character-form {
            background: #444;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }

        .empty-tier {
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            font-style: italic;
            width: 100%;
        }

        .character-title {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 2px;
            font-size: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–†–µ–¥–∞–∫—Ç–æ—Ä Tier-–ª–∏—Å—Ç–∞</h1>
        
        <div class="editor-panel">
            <div class="main-editor">
                <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å - —Ä–µ–¥–∞–∫—Ç–æ—Ä —Ç–∏—Ä–æ–≤ -->
                <div class="tier-editor-section">
                    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
                    <div class="upload-section">
                        <input type="file" id="image-upload" multiple accept="image/*" style="display: none;">
                        <button class="upload-btn" onclick="document.getElementById('image-upload').click()">
                            üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫–∏ (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ)
                        </button>
                    </div>
                    
                    <div id="tier-wrap">
                        <div id="tier-container">
                            <!-- Tier —Ä—è–¥—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                        </div>
                    </div>
                </div>

                <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
                <div class="controls">
                    <div class="form-group">
                        <label>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π Tier:</label>
                        <input type="text" id="new-tier-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: S-Tier)">
                        <input type="text" id="new-tier-label" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –®–µ–¥–µ—Ä—Ä)">
                        <div class="color-input-group">
                            <input type="color" id="new-tier-color" value="#ff7f7f" style="width: 60px; height: 40px; padding: 0;">
                            <input type="text" id="new-tier-color-text" placeholder="#ff7f7f" style="flex: 1;">
                            <div class="color-preview" id="color-preview" style="background: #ff7f7f;"></div>
                        </div>
                        <button onclick="addNewTier()">–î–æ–±–∞–≤–∏—Ç—å Tier</button>
                    </div>

                    <div class="form-group">
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ Tier –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</label>
                        <select id="select-tier" onchange="loadTierData()">
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ Tier --</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>–ò–∑–º–µ–Ω–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π Tier:</label>
                        <input type="text" id="edit-tier-name" placeholder="–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                        <input type="text" id="edit-tier-label" placeholder="–ù–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ">
                        <div class="color-input-group">
                            <input type="color" id="edit-tier-color" value="#ff7f7f" style="width: 60px; height: 40px; padding: 0;">
                            <input type="text" id="edit-tier-color-text" placeholder="#ff7f7f" style="flex: 1;">
                            <div class="color-preview" id="edit-color-preview" style="background: #ff7f7f;"></div>
                        </div>
                        <button onclick="updateTier()">–û–±–Ω–æ–≤–∏—Ç—å Tier</button>
                        <button class="btn-delete" onclick="deleteTier()">–£–¥–∞–ª–∏—Ç—å Tier</button>
                    </div>

                    <div class="edit-character-form" id="edit-character-form" style="display: none;">
                        <h4 style="color: #fff;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É:</h4>
                        <input type="text" id="edit-character-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∞–Ω–∏–º–µ">
                        <input type="text" id="edit-character-image" placeholder="URL –∫–∞—Ä—Ç–∏–Ω–∫–∏">
                        <button onclick="updateCharacter()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                         <button class="btn-delete" onclick="deleteCharacter()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
                        <button class="btn-delete" onclick="cancelEditCharacter()">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            </div>

            <div class="export-buttons">
                <button onclick="showJsonData()">üìã –ü–æ–∫–∞–∑–∞—Ç—å JSON</button>
                <button onclick="importFromFile()">üì• –ò–º–ø–æ—Ä—Ç –∏–∑ JSON</button>
            </div>

            <div id="json-display" style="display: none; margin-top: 20px; background: #333; padding: 15px; border-radius: 4px;">
                <h4 style="color: #fff;">JSON –¥–∞–Ω–Ω—ã–µ:</h4>
                <textarea id="json-textarea" style="width: 100%; height: 200px; background: #1A1A17; color: #fff; border: 1px solid #555; padding: 10px; font-family: monospace;"></textarea>
                <button onclick="copyJsonToClipboard()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON</button>
                <button onclick="hideJsonData()">‚ùå –°–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        let tierData = {
            "tier-unassigned": {
                name: "ALL",
                label: "",
                color: "#666666",
                characters: []
            }
        };
        let selectedCharacter = null;
        let selectedTier = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
        function initEditor() {
            setupColorInputs();
            setupImageUpload();
            updateTierSelects();
            renderTierList();
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–≤–µ—Ç–æ–≤—ã—Ö –∏–Ω–ø—É—Ç–æ–≤
        function setupColorInputs() {
            const colorInput = document.getElementById('new-tier-color');
            const colorText = document.getElementById('new-tier-color-text');
            const colorPreview = document.getElementById('color-preview');

            const editColorInput = document.getElementById('edit-tier-color');
            const editColorText = document.getElementById('edit-tier-color-text');
            const editColorPreview = document.getElementById('edit-color-preview');

            colorInput.addEventListener('input', function() {
                colorText.value = this.value;
                colorPreview.style.background = this.value;
            });

            colorText.addEventListener('input', function() {
                if (this.value.match(/^#[0-9A-F]{6}$/i)) {
                    colorInput.value = this.value;
                    colorPreview.style.background = this.value;
                }
            });

            editColorInput.addEventListener('input', function() {
                editColorText.value = this.value;
                editColorPreview.style.background = this.value;
            });

            editColorText.addEventListener('input', function() {
                if (this.value.match(/^#[0-9A-F]{6}$/i)) {
                    editColorInput.value = this.value;
                    editColorPreview.style.background = this.value;
                }
            });
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        function setupImageUpload() {
            const imageUpload = document.getElementById('image-upload');
            imageUpload.addEventListener('change', function(e) {
                const files = e.target.files;
                for (let file of files) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const character = {
                            title: file.name.replace(/\.[^/.]+$/, ""),
                            image: file.name,
                            dataUrl: e.target.result
                        };
                        
                        tierData["tier-unassigned"].characters.push(character);
                        renderTierList();
                    };
                    reader.readAsDataURL(file);
                }
                imageUpload.value = '';
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ select —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        function updateTierSelects() {
            const selectTier = document.getElementById('select-tier');
            selectTier.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ Tier --</option>';
            
            Object.keys(tierData).forEach(tierId => {
                const tier = tierData[tierId];
                const option = `<option value="${tierId}">${tier.name}</option>`;
                selectTier.innerHTML += option;
            });
        }

        // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ —Ç–∏—Ä–æ–≤
        function renderTierList() {
            const container = document.getElementById('tier-container');
            container.innerHTML = '';
            
            // –°–Ω–∞—á–∞–ª–∞ —Ä–µ–Ω–¥–µ—Ä–∏–º –æ–±—ã—á–Ω—ã–µ —Ç–∏—Ä—ã
            Object.keys(tierData).forEach(tierId => {
                if (tierId !== "tier-unassigned") {
                    const tier = tierData[tierId];
                    const tierHtml = createTierHtml(tierId, tier);
                    container.innerHTML += tierHtml;
                }
            });
            
            // –ó–∞—Ç–µ–º ALL –≤ —Å–∞–º–æ–º –Ω–∏–∑—É
            const unassignedTier = tierData["tier-unassigned"];
            const unassignedHtml = createTierHtml("tier-unassigned", unassignedTier);
            container.innerHTML += unassignedHtml;

            setupDragAndDrop();
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ HTML –¥–ª—è —Ç–∏—Ä–∞
        function createTierHtml(tierId, tier) {
            const charactersHtml = tier.characters.length > 0 
                ? tier.characters.map((char, index) => `
                    <div class="character" 
                         draggable="true"
                         data-tier="${tierId}"
                         data-index="${index}"
                         style="background-image: url('${char.dataUrl || char.image}')">
                        <div class="character-title">${char.title}</div>
                    </div>
                `).join('')
                : '<div class="empty-tier">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å—é–¥–∞</div>';
            
            return `
                <div class="tier-row">
                    <div class="label-holder" style="background: ${tier.color}">
                        <div class="label">${tier.name}<br>${tier.label}</div>
                    </div>
                    <div class="tier-content" id="${tierId}">
                        ${charactersHtml}
                    </div>
                </div>
            `;
        }

       // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
function setupDragAndDrop() {
    const characters = document.querySelectorAll('.character');
    const dropZones = document.querySelectorAll('.tier-content');
    
    let draggedItem = null;

    characters.forEach(character => {
        character.addEventListener('dragstart', function(e) {
            draggedItem = this;
            this.classList.add('dragging');
            e.dataTransfer.setData('text/plain', '');
            setTimeout(() => {
                this.style.opacity = '0.4';
            }, 0);
        });

        character.addEventListener('dragend', function() {
            this.classList.remove('dragging');
            setTimeout(() => {
                this.style.opacity = '1';
                draggedItem = null;
            }, 0);
        });

        // –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        character.addEventListener('dblclick', function() {
            const tierId = this.getAttribute('data-tier');
            const index = parseInt(this.getAttribute('data-index'));
            editCharacter(tierId, index);
        });
    });

    dropZones.forEach(zone => {
        zone.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('drag-over');
            
            if (!draggedItem) return;
            
            // –£–¥–∞–ª—è–µ–º empty-tier –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
            const emptyTier = this.querySelector('.empty-tier');
            if (emptyTier) {
                emptyTier.remove();
            }
            
            const afterElement = getDragAfterElement(this, e.clientX, e.clientY);
            const draggable = document.querySelector('.dragging');
            
            if (afterElement == null) {
                this.appendChild(draggable);
            } else {
                this.insertBefore(draggable, afterElement);
            }
        });

        zone.addEventListener('dragleave', function() {
            this.classList.remove('drag-over');
        });

        zone.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            
            if (draggedItem) {
                const sourceTierId = draggedItem.getAttribute('data-tier');
                const sourceIndex = parseInt(draggedItem.getAttribute('data-index'));
                const targetTierId = this.id;
                
                // –ü–æ–ª—É—á–∞–µ–º –í–°–ï —ç–ª–µ–º–µ–Ω—Ç—ã –≤–∫–ª—é—á–∞—è –ø—É—Å—Ç—ã–µ, –Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ character
                const children = Array.from(this.children).filter(child => 
                    child.classList.contains('character')
                );
                const draggableIndex = children.indexOf(draggedItem);
                
                if (sourceTierId !== targetTierId) {
                    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –º–µ–∂–¥—É —Ç–∏—Ä–∞–º–∏
                    const character = tierData[sourceTierId].characters[sourceIndex];
                    tierData[sourceTierId].characters.splice(sourceIndex, 1);
                    // –ï—Å–ª–∏ –∏–Ω–¥–µ–∫—Å -1 (–Ω–µ –Ω–∞–π–¥–µ–Ω), –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω–µ—Ü
                    const targetIndex = draggableIndex === -1 ? tierData[targetTierId].characters.length : draggableIndex;
                    tierData[targetTierId].characters.splice(targetIndex, 0, character);
                } else {
                    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ —Ç–∏—Ä–∞
                    const character = tierData[sourceTierId].characters[sourceIndex];
                    tierData[sourceTierId].characters.splice(sourceIndex, 1);
                    const targetIndex = draggableIndex === -1 ? tierData[targetTierId].characters.length : draggableIndex;
                    tierData[targetTierId].characters.splice(targetIndex, 0, character);
                }
                
                renderTierList();
            }
        });

        // –î–æ–±–∞–≤–ª—è–µ–º empty-tier –æ–±—Ä–∞—Ç–Ω–æ –µ—Å–ª–∏ –∑–æ–Ω–∞ –ø—É—Å—Ç–∞—è
        zone.addEventListener('dragend', function() {
            if (this.children.length === 0) {
                this.innerHTML = '<div class="empty-tier">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å—é–¥–∞</div>';
            }
        });
    });
}

// –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –≤—Å—Ç–∞–≤–∫–∏
function getDragAfterElement(container, x, y) {
    const draggableElements = [...container.querySelectorAll('.character:not(.dragging)')];
    
    // –ï—Å–ª–∏ –Ω–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º null (–±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ–Ω–µ—Ü)
    if (draggableElements.length === 0) return null;
    
    let closestElement = null;
    let closestDistance = Infinity;
    
    draggableElements.forEach(child => {
        const box = child.getBoundingClientRect();
        const centerX = box.left + box.width / 2;
        const centerY = box.top + box.height / 2;
        
        // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç –∫—É—Ä—Å–æ—Ä–∞ –¥–æ —Ü–µ–Ω—Ç—Ä–∞ —ç–ª–µ–º–µ–Ω—Ç–∞
        const distance = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));
        
        if (distance < closestDistance) {
            closestDistance = distance;
            closestElement = child;
        }
    });
    
    if (!closestElement) return null;
    
    const box = closestElement.getBoundingClientRect();
    const centerX = box.left + box.width / 2;
    
    // –ï—Å–ª–∏ –∫—É—Ä—Å–æ—Ä –ª–µ–≤–µ–µ —Ü–µ–Ω—Ç—Ä–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ - –≤—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ –Ω–∏–º
    // –ï—Å–ª–∏ –ø—Ä–∞–≤–µ–µ - –ø–æ—Å–ª–µ –Ω–µ–≥–æ
    if (x < centerX) {
        return closestElement;
    } else {
        return closestElement.nextElementSibling;
    }
}

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
        function editCharacter(tierId, index) {
            const character = tierData[tierId].characters[index];
            selectedCharacter = { tierId, index };
            
            document.getElementById('edit-character-title').value = character.title;
            document.getElementById('edit-character-image').value = character.image;
            document.getElementById('edit-character-form').style.display = 'block';
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
        function updateCharacter() {
            if (!selectedCharacter) return;
            
            const newTitle = document.getElementById('edit-character-title').value;
            const newImage = document.getElementById('edit-character-image').value;
            
            if (newTitle && newImage) {
                const currentDataUrl = tierData[selectedCharacter.tierId].characters[selectedCharacter.index].dataUrl;
                tierData[selectedCharacter.tierId].characters[selectedCharacter.index] = {
                    title: newTitle,
                    image: newImage,
                    dataUrl: currentDataUrl
                };
                
                renderTierList();
                cancelEditCharacter();
            } else {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
            }
        }

        // –û—Ç–º–µ–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏
        function cancelEditCharacter() {
            selectedCharacter = null;
            document.getElementById('edit-character-form').style.display = 'none';
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏—Ä–∞
        function addNewTier() {
            const name = document.getElementById('new-tier-name').value;
            const label = document.getElementById('new-tier-label').value;
            const color = document.getElementById('new-tier-color-text').value || document.getElementById('new-tier-color').value;
            
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∏—Ä–∞');
                return;
            }

            if (!color.match(/^#[0-9A-F]{6}$/i)) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ü–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ #FFFFFF');
                return;
            }
            
            const tierId = 'tier-' + Date.now();
            tierData[tierId] = {
                name: name,
                label: label,
                color: color,
                characters: []
            };
            
            updateTierSelects();
            renderTierList();
            
            document.getElementById('new-tier-name').value = '';
            document.getElementById('new-tier-label').value = '';
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–∏—Ä–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function loadTierData() {
            const tierId = document.getElementById('select-tier').value;
            if (!tierId) return;
            
            const tier = tierData[tierId];
            document.getElementById('edit-tier-name').value = tier.name;
            document.getElementById('edit-tier-label').value = tier.label;
            document.getElementById('edit-tier-color').value = tier.color;
            document.getElementById('edit-tier-color-text').value = tier.color;
            document.getElementById('edit-color-preview').style.background = tier.color;
            selectedTier = tierId;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∏—Ä–∞
        function updateTier() {
            if (!selectedTier) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏—Ä –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                return;
            }
            
            const newName = document.getElementById('edit-tier-name').value;
            const newLabel = document.getElementById('edit-tier-label').value;
            const newColor = document.getElementById('edit-tier-color-text').value || document.getElementById('edit-tier-color').value;
            
            if (newName) tierData[selectedTier].name = newName;
            if (newLabel) tierData[selectedTier].label = newLabel;
            if (newColor && newColor.match(/^#[0-9A-F]{6}$/i)) {
                tierData[selectedTier].color = newColor;
            }
            
            updateTierSelects();
            renderTierList();
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–∏—Ä–∞
        function deleteTier() {
            if (!selectedTier) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏—Ä –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                return;
            }
            
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–∏—Ä? –í—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–µ—Ä–µ–π–¥—É—Ç –≤ ALL.')) {
                tierData[selectedTier].characters.forEach(char => {
                    tierData["tier-unassigned"].characters.push(char);
                });
                
                delete tierData[selectedTier];
                selectedTier = null;
                updateTierSelects();
                renderTierList();
            }
        }

        // –ò–º–ø–æ—Ä—Ç –∏–∑ JSON —Ñ–∞–π–ª–∞
        function importFromFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json,application/json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (typeof importedData === 'object' && importedData !== null) {
                            tierData = importedData;
                            if (!tierData["tier-unassigned"]) {
                                tierData["tier-unassigned"] = {
                                    name: "ALL",
                                    label: "",
                                    color: "#666666",
                                    characters: []
                                };
                            }
                            updateTierSelects();
                            renderTierList();
                            alert('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                        } else {
                            alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                        }
                    } catch (error) {
                        alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + error.message);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å JSON –¥–∞–Ω–Ω—ã–µ
        function showJsonData() {
            const jsonDisplay = document.getElementById('json-display');
            const jsonTextarea = document.getElementById('json-textarea');
            
            const cleanTierData = JSON.parse(JSON.stringify(tierData));
            Object.keys(cleanTierData).forEach(tierId => {
                cleanTierData[tierId].characters.forEach(char => {
                    delete char.dataUrl;
                });
            });
            
            jsonTextarea.value = JSON.stringify(cleanTierData, null, 2);
            jsonDisplay.style.display = 'block';
        }

        // –°–∫—Ä—ã—Ç—å JSON –¥–∞–Ω–Ω—ã–µ
        function hideJsonData() {
            document.getElementById('json-display').style.display = 'none';
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        function copyJsonToClipboard() {
            const jsonTextarea = document.getElementById('json-textarea');
            jsonTextarea.select();
            document.execCommand('copy');
            alert('‚úÖ JSON —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
function deleteCharacter() {
    if (!selectedCharacter) {
        alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
        return;
    }
    
    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ä—Ç–æ—á–∫—É?')) {
        const { tierId, index } = selectedCharacter;
        
        // –£–¥–∞–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –∏–∑ –¥–∞–Ω–Ω—ã—Ö
        tierData[tierId].characters.splice(index, 1);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        renderTierList();
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        cancelEditCharacter();
        
        alert('–ö–∞—Ä—Ç–æ—á–∫–∞ —É–¥–∞–ª–µ–Ω–∞!');
    }
}
        // –ó–∞–ø—É—Å–∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initEditor);
    </script>
</body>
</html>